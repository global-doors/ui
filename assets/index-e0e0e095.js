import{J as Z,K as k,M as _,N as V,O as L,Q as $,U as ee,V as te,X as G,Y as se,Z as j,r as y,$ as re,a0 as ne,a1 as ae,a2 as ie,j as r,a3 as H,B as b,a4 as le,y as oe,a5 as A,p as B,a6 as ue,S as C,I as g,g as ce,a7 as de,W as he,D as fe,a8 as pe,E as me,e as ye}from"./index-ada69f05.js";import{b as ve,c as xe,M as Re,d as be,e as ge,O as Se,f as Ce,F as je,R as D,u as Ie}from"./rhf-text-field-0c057798.js";import{M as Oe,C as w,D as we,R as K,a as Qe}from"./rhf-date-picker-2fd93bd9.js";import{B as U}from"./Button-fc0e2fcb.js";import{I as T}from"./Close-9b21d313.js";import{C as Ee}from"./CardContent-6873759d.js";class Fe extends Z{constructor(e,t){super(),this.client=e,this.options=t,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(t)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.currentQuery.addObserver(this),q(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return N(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return N(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(e,t){const n=this.options,u=this.currentQuery;if(this.options=this.client.defaultQueryOptions(e),k(n,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=n.queryKey),this.updateQuery();const a=this.hasListeners();a&&Y(this.currentQuery,u,this.options,n)&&this.executeFetch(),this.updateResult(t),a&&(this.currentQuery!==u||this.options.enabled!==n.enabled||this.options.staleTime!==n.staleTime)&&this.updateStaleTimeout();const i=this.computeRefetchInterval();a&&(this.currentQuery!==u||this.options.enabled!==n.enabled||i!==this.currentRefetchInterval)&&this.updateRefetchInterval(i)}getOptimisticResult(e){const t=this.client.getQueryCache().build(this.client,e),n=this.createResult(t,e);return De(this,n,e)&&(this.currentResult=n,this.currentResultOptions=this.options,this.currentResultState=this.currentQuery.state),n}getCurrentResult(){return this.currentResult}trackResult(e){const t={};return Object.keys(e).forEach(n=>{Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(n),e[n])})}),t}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:e,...t}={}){return this.fetch({...t,meta:{refetchPage:e}})}fetchOptimistic(e){const t=this.client.defaultQueryOptions(e),n=this.client.getQueryCache().build(this.client,t);return n.isFetchingOptimistic=!0,n.fetch().then(()=>this.createResult(n,t))}fetch(e){var t;return this.executeFetch({...e,cancelRefetch:(t=e.cancelRefetch)!=null?t:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(e){this.updateQuery();let t=this.currentQuery.fetch(this.options,e);return e!=null&&e.throwOnError||(t=t.catch(_)),t}updateStaleTimeout(){if(this.clearStaleTimeout(),V||this.currentResult.isStale||!L(this.options.staleTime))return;const t=$(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},t)}computeRefetchInterval(){var e;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(e=this.options.refetchInterval)!=null?e:!1}updateRefetchInterval(e){this.clearRefetchInterval(),this.currentRefetchInterval=e,!(V||this.options.enabled===!1||!L(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||ee.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(e,t){const n=this.currentQuery,u=this.options,a=this.currentResult,i=this.currentResultState,c=this.currentResultOptions,h=e!==n,o=h?e.state:this.currentQueryInitialState,d=h?this.currentResult:this.previousQueryResult,{state:l}=e;let{dataUpdatedAt:f,error:p,errorUpdatedAt:S,fetchStatus:R,status:m}=l,I=!1,z=!1,x;if(t._optimisticResults){const v=this.hasListeners(),M=!v&&q(e,t),X=v&&Y(e,n,t,u);(M||X)&&(R=te(e.options.networkMode)?"fetching":"paused",f||(m="loading")),t._optimisticResults==="isRestoring"&&(R="idle")}if(t.keepPreviousData&&!l.dataUpdatedAt&&d!=null&&d.isSuccess&&m!=="error")x=d.data,f=d.dataUpdatedAt,m=d.status,I=!0;else if(t.select&&typeof l.data<"u")if(a&&l.data===(i==null?void 0:i.data)&&t.select===this.selectFn)x=this.selectResult;else try{this.selectFn=t.select,x=t.select(l.data),x=G(a==null?void 0:a.data,x,t),this.selectResult=x,this.selectError=null}catch(v){this.selectError=v}else x=l.data;if(typeof t.placeholderData<"u"&&typeof x>"u"&&m==="loading"){let v;if(a!=null&&a.isPlaceholderData&&t.placeholderData===(c==null?void 0:c.placeholderData))v=a.data;else if(v=typeof t.placeholderData=="function"?t.placeholderData():t.placeholderData,t.select&&typeof v<"u")try{v=t.select(v),this.selectError=null}catch(M){this.selectError=M}typeof v<"u"&&(m="success",x=G(a==null?void 0:a.data,v,t),z=!0)}this.selectError&&(p=this.selectError,x=this.selectResult,S=Date.now(),m="error");const Q=R==="fetching",E=m==="loading",F=m==="error";return{status:m,fetchStatus:R,isLoading:E,isSuccess:m==="success",isError:F,isInitialLoading:E&&Q,data:x,dataUpdatedAt:f,error:p,errorUpdatedAt:S,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>o.dataUpdateCount||l.errorUpdateCount>o.errorUpdateCount,isFetching:Q,isRefetching:Q&&!E,isLoadingError:F&&l.dataUpdatedAt===0,isPaused:R==="paused",isPlaceholderData:z,isPreviousData:I,isRefetchError:F&&l.dataUpdatedAt!==0,isStale:W(e,t),refetch:this.refetch,remove:this.remove}}updateResult(e){const t=this.currentResult,n=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,k(n,t))return;this.currentResult=n;const u={cache:!0},a=()=>{if(!t)return!0;const{notifyOnChangeProps:i}=this.options,c=typeof i=="function"?i():i;if(c==="all"||!c&&!this.trackedProps.size)return!0;const h=new Set(c??this.trackedProps);return this.options.useErrorBoundary&&h.add("error"),Object.keys(this.currentResult).some(o=>{const d=o;return this.currentResult[d]!==t[d]&&h.has(d)})};(e==null?void 0:e.listeners)!==!1&&a()&&(u.listeners=!0),this.notify({...u,...e})}updateQuery(){const e=this.client.getQueryCache().build(this.client,this.options);if(e===this.currentQuery)return;const t=this.currentQuery;this.currentQuery=e,this.currentQueryInitialState=e.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(t==null||t.removeObserver(this),e.addObserver(this))}onQueryUpdate(e){const t={};e.type==="success"?t.onSuccess=!e.manual:e.type==="error"&&!se(e.error)&&(t.onError=!0),this.updateResult(t),this.hasListeners()&&this.updateTimers()}notify(e){j.batch(()=>{if(e.onSuccess){var t,n,u,a;(t=(n=this.options).onSuccess)==null||t.call(n,this.currentResult.data),(u=(a=this.options).onSettled)==null||u.call(a,this.currentResult.data,null)}else if(e.onError){var i,c,h,o;(i=(c=this.options).onError)==null||i.call(c,this.currentResult.error),(h=(o=this.options).onSettled)==null||h.call(o,void 0,this.currentResult.error)}e.listeners&&this.listeners.forEach(({listener:d})=>{d(this.currentResult)}),e.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function Me(s,e){return e.enabled!==!1&&!s.state.dataUpdatedAt&&!(s.state.status==="error"&&e.retryOnMount===!1)}function q(s,e){return Me(s,e)||s.state.dataUpdatedAt>0&&N(s,e,e.refetchOnMount)}function N(s,e,t){if(e.enabled!==!1){const n=typeof t=="function"?t(s):t;return n==="always"||n!==!1&&W(s,e)}return!1}function Y(s,e,t,n){return t.enabled!==!1&&(s!==e||n.enabled===!1)&&(!t.suspense||s.state.status!=="error")&&W(s,t)}function W(s,e){return s.isStaleByTime(e.staleTime)}function De(s,e,t){return t.keepPreviousData?!1:t.placeholderData!==void 0?e.isPlaceholderData:!k(s.getCurrentResult(),e)}const J=y.createContext(!1),Te=()=>y.useContext(J);J.Provider;function Pe(){let s=!1;return{clearReset:()=>{s=!1},reset:()=>{s=!0},isReset:()=>s}}const ke=y.createContext(Pe()),Ue=()=>y.useContext(ke),Ne=(s,e)=>{(s.suspense||s.useErrorBoundary)&&(e.isReset()||(s.retryOnMount=!1))},Ae=s=>{y.useEffect(()=>{s.clearReset()},[s])},Be=({result:s,errorResetBoundary:e,useErrorBoundary:t,query:n})=>s.isError&&!e.isReset()&&!s.isFetching&&re(t,[s.error,n]),We=s=>{s.suspense&&typeof s.staleTime!="number"&&(s.staleTime=1e3)},ze=(s,e)=>s.isLoading&&s.isFetching&&!e,Ve=(s,e,t)=>(s==null?void 0:s.suspense)&&ze(e,t),Le=(s,e,t)=>e.fetchOptimistic(s).then(({data:n})=>{s.onSuccess==null||s.onSuccess(n),s.onSettled==null||s.onSettled(n,null)}).catch(n=>{t.clearReset(),s.onError==null||s.onError(n),s.onSettled==null||s.onSettled(void 0,n)});function Ge(s,e){const t=ne({context:s.context}),n=Te(),u=Ue(),a=t.defaultQueryOptions(s);a._optimisticResults=n?"isRestoring":"optimistic",a.onError&&(a.onError=j.batchCalls(a.onError)),a.onSuccess&&(a.onSuccess=j.batchCalls(a.onSuccess)),a.onSettled&&(a.onSettled=j.batchCalls(a.onSettled)),We(a),Ne(a,u),Ae(u);const[i]=y.useState(()=>new e(t,a)),c=i.getOptimisticResult(a);if(ae(y.useCallback(h=>{const o=n?()=>{}:i.subscribe(j.batchCalls(h));return i.updateResult(),o},[i,n]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),y.useEffect(()=>{i.setOptions(a,{listeners:!1})},[a,i]),Ve(a,c,n))throw Le(a,i,u);if(Be({result:c,errorResetBoundary:u,useErrorBoundary:a.useErrorBoundary,query:i.getCurrentQuery()}))throw c.error;return a.notifyOnChangeProps?c:i.trackResult(c)}function He(s,e,t){const n=ie(s,e,t);return Ge(n,Fe)}const O=({name:s,chip:e,label:t,options:n,checkbox:u,placeholder:a,helperText:i,sx:c,...h})=>{const{control:o}=ve(),d=l=>{const f=n.filter(p=>l.includes(p.value));return!f.length&&a?r.jsx(b,{component:"em",sx:{color:"text.disabled"},children:a}):e?r.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:f.map(p=>r.jsx(w,{label:p.label,size:"small"},p.value))}):f.map(p=>p.label).join(", ")};return r.jsx(xe,{control:o,name:s,render:({field:l,fieldState:{error:f}})=>r.jsxs(Re,{size:"small",sx:c,children:[t&&r.jsxs(be,{id:s,children:[" ",t," "]}),r.jsxs(ge,{...l,displayEmpty:!!a,input:r.jsx(Se,{error:!!f,fullWidth:!0,label:t,size:"small"}),labelId:s,multiple:!0,renderValue:d,size:"small",...h,children:[a&&r.jsx(H,{disabled:!0,value:"",children:r.jsxs("em",{children:[" ",a," "]})}),n.map(p=>{const S=l.value.includes(p.value);return r.jsxs(H,{value:p.value,children:[u&&r.jsx(Oe,{checked:S,disableRipple:!0,size:"small"}),p.label]},p.value)})]}),(!!f||i)&&r.jsx(Ce,{error:!!f,children:f?f==null?void 0:f.message:i})]})})},Ke=s=>{const{revoke:e}=le(),{enqueueSnackbar:t}=oe(),n=A();return{staleTime:15e3,...s,retry:!1,refetchOnWindowFocus:!1,onError:u=>{var i,c,h,o,d;(i=s==null?void 0:s.onError)==null||i.call(s,u);const a=((c=u.response)==null?void 0:c.status)??0;a===401?(e(),n(B.auth.jwt.login),t("Unauthorised Action.",{variant:"error"})):a>=400&&a<500?t(((h=u.response)==null?void 0:h.data.message)??((o=u.response)==null?void 0:o.data),{variant:"warning"}):t(`A server error occurred: ${((d=u.response)==null?void 0:d.data.message)??u.message}`,{variant:"error"})}}},qe=s=>He(["sales-orders",s],()=>ue(s),Ke()),Ye=()=>[{field:"OrderNumber",headerName:"Order No."},{field:"OrderDate",headerName:"Order Date"},{field:"OrderStatus",headerName:"Status"},{field:"CurrencyCode",headerName:"Currency",valueGetter:s=>{var e,t;return(t=(e=s.row)==null?void 0:e.Currency)==null?void 0:t.CurrencyCode}},{field:"cost",headerName:"Cost",valueGetter:()=>"TODO"}],Je=({data:s,loading:e=!1,...t})=>{const n=A(),u=a=>{const i=a.row.OrderNumber,c=B.dashboard.sales.order;n(c(i))};return r.jsx(we,{...t,autoHeight:!0,columns:Ye(),disableColumnMenu:!0,disableRowSelectionOnClick:!0,getRowId:a=>a.OrderNumber,loading:e,onRowClick:u,paginationMode:"server",rows:s,sx:{mx:-3,"& .MuiDataGrid-row":{cursor:"pointer"}}})},P=({label:s,children:e,sx:t,...n})=>r.jsxs(C,{component:ce,direction:"row",spacing:1,sx:{p:1,borderRadius:1,overflow:"hidden",borderStyle:"dashed",...t},variant:"outlined",...n,children:[r.jsx(b,{component:"span",sx:{typography:"subtitle2"},children:s}),r.jsx(C,{direction:"row",flexWrap:"wrap",spacing:1,children:e})]}),Xe=({filters:s,onFilters:e,onResetFilters:t,results:n,...u})=>{const a=o=>{const d=s.orderStatus.filter(l=>l!==o);e("orderStatus",d)},i=o=>{const d=s.warehouse.filter(l=>l!==o);e("warehouse",d)},c=o=>{const d=s.deliveryMethod.filter(l=>l!==o);e("deliveryMethod",d)},h=!!s.orderStatus.length&&!!s.deliveryMethod.length&&!!s.warehouse.length;return r.jsxs(C,{alignItems:"flex-end",direction:"row",spacing:1,...u,children:[r.jsxs(C,{alignItems:"center",direction:"row",flexGrow:1,flexWrap:"wrap",spacing:1,children:[!!s.orderStatus.length&&r.jsx(P,{label:"Status:",children:s.orderStatus.map(o=>r.jsx(w,{label:o,onDelete:()=>a(o),size:"small"},o))}),!!s.warehouse.length&&r.jsx(P,{label:"Warehouse:",children:s.warehouse.map(o=>r.jsx(w,{label:o,onDelete:()=>i(o),size:"small"},o))}),!!s.deliveryMethod.length&&r.jsx(P,{label:"Delivery Method:",children:s.deliveryMethod.map(o=>r.jsx(w,{label:o,onDelete:()=>c(o),size:"small"},o))}),h&&r.jsx(U,{color:"error",onClick:t,startIcon:r.jsx(g,{icon:"solar:trash-bin-minimalistic-line-duotone"}),children:"Clear"})]}),r.jsxs(b,{sx:{typography:"body2"},children:[r.jsx("strong",{children:n}),r.jsx(b,{component:"span",sx:{color:"text.secondary",ml:.25},children:"results found"})]})]})},Ze=[{label:"Placed",value:"placed"},{label:"Pending",value:"pending"}],_e=[{label:"Warehouse 1",value:"warehouse1"}],$e=[{label:"Royal Mail",value:"royalMail"}],et=[{label:"Yes",value:"yes"},{label:"No",value:"no"}],tt=({methods:s,resultsCount:e,showFilters:t})=>{const n=(a,i)=>{s.reset(c=>({...c,[a]:i}))},u=()=>s.reset();return r.jsxs(je,{methods:s,children:[r.jsx(de,{in:t,children:r.jsxs(C,{spacing:2,children:[r.jsxs(b,{columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(5, 1fr)"},rowGap:3,children:[r.jsx(O,{checkbox:!0,fullWidth:!0,label:"Status",name:"orderStatus",options:Ze,size:"small"}),r.jsx(D,{InputProps:{startAdornment:r.jsx(T,{position:"start",children:r.jsx(g,{icon:"solar:magnifer-line-duotone"})})},label:"Customer Name",name:"customerName"}),r.jsx(D,{InputProps:{startAdornment:r.jsx(T,{position:"start",children:r.jsx(g,{icon:"solar:magnifer-line-duotone"})})},label:"Order Number",name:"orderNumber"}),r.jsx(O,{checkbox:!0,fullWidth:!0,label:"Warehouse",name:"warehouse",options:_e})]}),r.jsxs(b,{columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(5, 1fr)"},rowGap:3,children:[r.jsx(D,{InputProps:{startAdornment:r.jsx(T,{position:"start",children:r.jsx(g,{icon:"solar:magnifer-line-duotone"})})},label:"Customer Reference",name:"customerRef"}),r.jsx(O,{checkbox:!0,label:"Delivery Method",name:"deliveryMethod",options:$e}),r.jsx(O,{label:"Printed",name:"printed",options:et}),r.jsx(K,{label:"Date From",name:"dateFrom"}),r.jsx(K,{label:"Date To",name:"dateTo"})]})]})}),r.jsx(b,{sx:{py:1},children:r.jsx(Xe,{filters:s.watch(),onFilters:n,onResetFilters:u,results:e})})]})},ut=()=>{const e=Ie({defaultValues:{orderStatus:[],customerName:"",orderNumber:"",customerRef:"",warehouse:[],deliveryMethod:[],printed:[],dateFrom:void 0,dateTo:void 0},mode:"onChange"}),[t,n]=y.useState(!0),u=()=>n(!t),a=A(),[i,c]=y.useState({page:0,pageSize:5}),{data:h,isLoading:o}=qe({page:i.page+1,pageSize:i.pageSize}),d=h==null?void 0:h.Items,l=h==null?void 0:h.Pagination,f=e.watch(),p=y.useMemo(()=>{let m=(d??[]).slice();return f.orderStatus.length&&(m=m.filter(I=>f.orderStatus.includes(I.OrderStatus))),m},[d,f.orderStatus]),[S,R]=y.useState((l==null?void 0:l.PageSize)||0);return y.useEffect(()=>{R(m=>(l==null?void 0:l.NumberOfItems)!==void 0?l==null?void 0:l.NumberOfItems:m)},[l==null?void 0:l.NumberOfItems,R]),r.jsxs(r.Fragment,{children:[r.jsx(he,{children:r.jsx("title",{children:" View Sales Orders"})}),r.jsxs(fe,{maxWidth:"xl",children:[r.jsx(pe,{action:r.jsxs(C,{direction:"row",spacing:1,children:[r.jsx(U,{startIcon:r.jsx(g,{icon:"solar:export-line-duotone"}),variant:"outlined",children:"Export"}),r.jsx(U,{onClick:()=>a("/dashboard/sales/add-order"),startIcon:r.jsx(g,{icon:"solar:add-square-line-duotone"}),variant:"contained",children:"Add Sales Order"})]}),heading:"View Sales Orders",links:[{name:"Sales",href:B.dashboard.root},{name:"View Sales Orders"}],sx:{mb:{xs:3,md:5}}}),r.jsxs(me,{children:[r.jsx(Qe,{action:r.jsx(ye,{onClick:u,children:r.jsx(g,{icon:t?"solar:filter-bold-duotone":"solar:filter-line-duotone"})})}),r.jsxs(Ee,{sx:{pt:0},children:[r.jsx(tt,{methods:e,resultsCount:p.length,showFilters:t}),r.jsx(Je,{data:p,loading:o,onPaginationModelChange:c,paginationMode:"server",paginationModel:i,rowCount:S})]})]})]})]})};export{ut as default};
